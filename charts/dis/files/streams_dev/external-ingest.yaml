## Generated by config-gen DO NOT EDIT
input:
  label: "ingest_server_input"
  http_server:
      address: 0.0.0.0:9443
      path: /integration/{connection_id}/store
      allowed_verbs:
        - POST
      timeout: 5s
      rate_limit: "connection_rate_limit"
      tls:
        enabled: true
        client_root_cas_file: /etc/ssl/certs/dis/root_ca.crt
        server_certs:
          - cert_file: /etc/ssl/certs/dis/tls.crt
            key_file: /etc/ssl/certs/dis/tls.key
        require_mutual_tls: true
      sync_response:
        status: "200"
        headers:
          Content-Type: application/octet-stream
pipeline:
  processors:
    - label: "cloudevent_switch"
      switch:
    - catch:
        - label: "convert_cloudevent_errors"
          log:
            level: WARN
            message: "failed to convert to cloudevent: ${!error()}"
            fields_mapping: |
               source = "@http_server_request_path"
        - mapping: root = deleted()
output:
  label: "all_output_broker"
  broker:
    pattern: fan_out
    outputs:
      - label: "clickhouse_signal_drop_on_error"
        drop_on:
          error: true
          output:
            label: "clickhouse_signal_insert_file"
            switch:
              cases:
            processors:
              - label: convert_signals_switch
                switch:
              - catch:
                  - label: "log_convert_errors"
                    log:
                      level: WARN
                      message: "status processing failed: ${!error()}"
                      fields_mapping: |
                        vehicleTokenId = this.tokenId.or(-1)
                        source = this.source.or("unknown")
                  - mapping: root = deleted()      
      - label: "object_output_drop_on_error"
        drop_on:
          error: true
          output:
            label: "s3_object_insert"
            switch:
              cases:
            processors:
              - label: "s3_file_mapping"
                mapping: |
                  root.msg = this
                  root.metadata = metadata()